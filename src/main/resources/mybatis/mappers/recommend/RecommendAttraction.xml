<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="recommend">
<select id="getRecommends" resultType="recommendvo">
	<!-- select * from recommendtest where 
		<foreach collection="list" item="item" index="index" separator="or">
                 location like concat(#{item}, '%')
        </foreach>    -->
        
        <!-- select * from (
			        	select * from recommendtest where 
							<foreach collection="list" item="item" index="index" separator="or">
			                	location like concat(#{item}, '%')
			        		</foreach>   
        			  ) t where t.lat != 0 and t.lot != 0 -->
        			  
		  select * from (
				    	select * from TB_RECOMMEND where 
						<foreach collection="list" item="item" index="index" separator="or">
			            	location like concat(#{item}, '%')
			    		</foreach>   
			 			  ) t where t.lat != 0 and t.lot != 0
</select>

<select id="getNearby" resultType="postvo" parameterType="postvo">
	<![CDATA[
		SELECT *, (6371 * ACOS( COS( RADIANS( #{lat } ) ) * COS ( RADIANS( p.lat ) ) * COS ( RADIANS ( p.lot )-RADIANS( #{lot } ) ) + SIN( RADIANS( #{lat } ) ) * SIN( RADIANS( p.lat )))) AS distance 
			FROM TB_POST p
			where location like concat('%', #{location}, '%') and p.lat != 0
			HAVING distance <= 2
			ORDER BY distance 
			LIMIT 0, 100;
	]]>
</select>

<select id="getCountry" resultType="String">
	<!-- select name from countrytest where name in
		<foreach collection="array" item="item" index="index" separator="," open="(" close=")">
	       	#{item }
	    </foreach>    -->
	    
	    select name from TB_COUNTRY where name in
		<foreach collection="array" item="item" index="index" separator="," open="(" close=")">
	       	#{item }
	    </foreach>   
</select>
</mapper>
