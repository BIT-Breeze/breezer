<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tourMain">

	<select id="getPostList" parameterType="map" resultType="postvo">
		<![CDATA[
		select ifnull(G.dateGap, '') dateGap, P.*
		  from TB_POST P left join (select DATEDIFF(DATE_FORMAT(P.tripDateTime, '%Y-%m-%d'), T.startDate)+1 dateGap, min(P.idx) idx
									  from TB_POST P left join TB_TOUR T
										on P.tourIdx = T.idx
									 where P.userId = #{userId}
									   and P.tourIdx = #{tourIdx}
								  group by dateGap) G
			on P.idx = G.idx
		 where P.userId = #{userId}
		   and P.tourIdx = #{tourIdx}
		]]>
	</select>

	<select id="getTour" parameterType="map" resultType="tourvo">
		<![CDATA[
		select *
		  from TB_TOUR 
		 where userId = #{userId} 
		   and idx = #{tourIdx}
		]]>
	</select>

</mapper>


















