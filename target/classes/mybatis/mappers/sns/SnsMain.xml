<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sns">
	<select id="getlist" parameterType="long" resultType="snsvo">
		<![CDATA[
			select * 
			from (select @ROWNUM := @ROWNUM + 1 as idx, f.*
					from (select p.tourIdx tourIdx, p.idx postIdx, p.userId, u.nickName nickName,
					  				null title,  p.content, p.photo, null startDate, 
					  				null endDate, p.score, p.hit,    p.postDateTime, 
									p.tripDateTime,  p.location, u.pictureUrl
							from TB_POST p, TB_TOUR t, TB_USER u
							where p.userId = u.id and p.tourIdx = t.idx
							UNION ALL 
							select 	t.idx tourIdx, null postIdx, t.userId, u.nickName nickName, t.title title, 
										null content, t.mainPhoto photo,    t.startDate,    
										t.endDate, t.score, t.hit, null postDateTime, 
										p.tripDateTime, null location, u.pictureUrl
							from TB_TOUR t, (	select p.tourIdx, p.idx, p.userId, max(p.tripDateTime) tripDateTime
													from TB_POST p
													group by p.tourIdx) p , TB_USER u
							where t.idx = p.tourIdx and t.userId = p.userId and t.userId = u.id) f , (SELECT @ROWNUM := 0) r 
					
					order by f.tripDateTime, f.title ) result
		]]>
		<if test="_parameter > 0"> 
		   <![CDATA[
		   		where idx < #{_parameter }
		   ]]>
	    </if>
		<![CDATA[
			order by idx desc
	    	limit 10
		]]>
	</select>		
	
			
			
	
</mapper>
